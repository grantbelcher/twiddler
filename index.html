<!DOCTYPE html>
<html>
  <head>
    <title>Twiddler</title>
    <link rel="stylesheet" href="index.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="jquery.timeago.js"></script>
  </head>


  <body>

    <h1>'Grants Twiddler'</h1>




    <script>
 
      $(document).ready(function(){






        var $body = $('body');
        $body.html('');

          // var clickHandler = function() {
          //    alert('You clicked on me!');
          //     };




        var storage = {}

       for (var key in streams.users){
        storage[key] = 0
       }



        var title = "Grant's Awesome Social Media Website"
        var $title = $('<h1></h1>')
        $title.text(title)
        $title.appendTo($body)

        var $rightHead = $('<h2></h2>')
        $rightHead.text('')
        $rightHead.appendTo($body);





        var $button = $('<button><button')
        $button.text('update feed')
        $button.appendTo($body);

                    var $line = $('<hr/>')
          $line.appendTo($body)




          // var $break = $('<br /><br/>')
          // $break.prependTo($newTweets) 


          var $userFeed = $('<a></a>')
          $userFeed.text()
          $userFeed.appendTo($body)



        // var newTweets = "<h4>'new tweets'<h4>"
        var $newTweets = $('<h3></h3>')
        // $newTweets.text(newTweets)
        $newTweets.appendTo($body)


        // var right = 'Right Twiddler'
        // var $right = $('<h2></h2>')
        // $right.text(right)
        // $right.appendTo($body)



        var getTime = function(timeObj){

        // var time = (JSON.stringify(streams.home[0].created_at))
        var time = JSON.stringify(timeObj)
        var result;
        var hr = Number(time.slice(12, 14)) - 8
        var min = Number(time.slice(15, 17))
        var sec = Number(time.slice(18, 20))

        if (min < 10){
          min = '0' + min
        }

        if (sec < 10){
          sec = '0' + sec
        }

        result = hr + ':' + min + ':' + sec
        if (hr < 12){
          result += ' AM'
        } else {
          result += ' PM'
        }

        return result
      }




        function displayTime() {
          var str = "";

          var currentTime = new Date()
          var hours = currentTime.getHours()
           var minutes = currentTime.getMinutes()
          var seconds = currentTime.getSeconds()

          if (minutes < 10) {
           minutes = "0" + minutes
            }
            if (seconds < 10) {
        seconds = "0" + seconds
            }
            str += hours + ":" + minutes + ":" + seconds + " ";
              if(hours > 11){
               str += "PM"
              } else {
                str += "AM"
               }
                 return str;
              }
        
          // var $line = $('<hr/>')
          // $line.appendTo($body)

          // var $break = $('<br /><br/>')
          // $break.appendTo($body) 


        var index = streams.home.length - 1;
        while(index >= 0){





          var tweet = streams.home[index];

          var $tweet = $('<div class= user></div>');

          
          // console.log(streams.users[profileName])
          //creating a 'user variable'
          // make each user a clickable element
          // make function that displays elements on body aligrned to the right
          // 
          // add user variable to original tweets and newly created tweets


          // var user = profileName;
          // $user = $('<p></p>');
          // $user.text('@' + user + ' ');

          // var $userName = $('<' + tweet.user + '><' + tweet.user + '>')
          $userName = $('<g></g>')
          $userName.text('@' + tweet.user + ':')
          $userName.appendTo($body)

          $tweet.text(tweet.message);
          $tweet.appendTo($body);




          // $('div').on('click', clickHandler)


          



          
          // $('div').on('click', function(){
           
            
          //   var usersTweets = streams.users
            
          //   console.log(usersTweets)
          //   var ind = usersTweets.length - 1


          //   while(ind >= 0){



          //     var tweed = usersTweets[ind]
          //     var $tweed = $('<p></p>');
          //     $tweed.text('@' + tweed.user + ': ' + tweed.message);
          //     //TRY APPEND TO $RIGHT ELEMENT, ADD BORDER TO RIGHT HAND ELEMENT SO ITS DISPLAYED IN BOX
          //     //ALERT TEXT; JSON.stringify(array of users tweets)
          //     $tweed.appendTo($body)


          //     ind -= 1;
          //   }

          //  })

          var time = displayTime()
          var $time = $('<t></t>')     
          $time.text(time)
          $time.appendTo($body)    

          var $break = $('<br /><br/>')
          $break.appendTo($body) 
          // var $line = $('<hr/>')
          // $line.appendTo($body)

          index -= 1;
        
}


// GENERATE USER FEED WHEN a <g> ELEMENT IS CLICKED


          var counter = 0;
          var originalLength = (streams.users[tweet.user].length - 1)

          var start

        var clickHandler = function(){


 

          // var text1 = $('g').text()
          // console.log(text1)
          var currentUser = ($(this).text())
          currentUser = (currentUser.slice(1, currentUser.length - 1));

          // console.log(streams.users[currentUser])
          
          console.log(storage[currentUser])

          $('h2').text('@' + currentUser + "'s Timeline")

          $userFeed.empty()


          if (storage[currentUser] < 1){



          for (var i = 0; i < streams.users[currentUser].length; i++){


          
          var newTime = getTime(streams.users[currentUser][i].created_at)
          var $newTime = $('<t></t>')
          $newTime.text(newTime)
          $newTime.prependTo($userFeed)
          

          var oldTweet = streams.users[currentUser][i];
          var $oldTweet = $('<div class= user></div>');
          $oldTweet.text('@' + oldTweet.user + ': ' + oldTweet.message);
          $oldTweet.prependTo($userFeed);



          // var nameFeed = '@' + oldTweet.user + ':'
          // var $nameFeed = $('<g></g>');
          // $nameFeed.text(nameFeed);
          // $nameFeed.prependTo($userFeed)




          }
          start = streams.users[currentUser].length
          storage[currentUser]++

         } else {

            var end = streams.users[currentUser].length
            

            for (var j = 0; j < streams.users[currentUser].length; j++){

              var newTime = getTime(streams.users[currentUser][j].created_at)
              var $newTime = $('<t></t>')
              $newTime.text(newTime)
              $newTime.prependTo($userFeed)

              var oldTweet = streams.users[currentUser][j];
              var $oldTweet = $('<div class= user></div>');
              $oldTweet.text('@' + oldTweet.user + ': ' + oldTweet.message);
              $oldTweet.prependTo($userFeed);

            }

                start = end 

         }




        }



          $('g').on('click', clickHandler)


// SHOWS NEW TWEETS WHEN UPDATE BUTTON IS PUSHED

        var firstNew = streams.home.length


        $button.on('click', function(){

        //   console.log(firstNew)
        

        // console.log(streams.home.slice(firstNew, streams.home.length))

        for (var k = firstNew; k < streams.home.length; k++){

          // console.log(getTime(streams.home[k].created_at))

          var newTime = getTime(streams.home[k].created_at)
          var $newTime = $('<t></t>')
          $newTime.text(newTime)
          $newTime.prependTo($newTweets)

          var newTweet = streams.home[k]




          var $newTweet = $('<div></div>');
          $newTweet.text( newTweet.message)
          $newTweet.prependTo($newTweets);


          $userName = $('<g></g>')
          $userName.text('@' + newTweet.user + ':')
          $userName.prependTo($newTweets)

          var $break = $('<br /><br/>')
          $break.prependTo($newTweets) 

        }


        firstNew = streams.home.length

        $('g').on('click', clickHandler)


          // var time = displayTime()
          // var $time = $('<t></t>')     
          // $time.text(time)
          // $time.prependTo($newTweets)  
          // generateRandomTweet();

          // for ()
          // var newTweet = streams.home.pop();
          // var $user = $('<></>')
          // var $newTweet = $('<div></div>');
          // $newTweet.text('@' + newTweet.user + ': ' + newTweet.message);
          // $newTweet.prependTo($newTweets);
          // $newTweet.prependTo($newTweets)
          // var $line = $('<hr/>')
          // $line.prependTo($newTweets)
          
          //         })

        //   var $break = $('<br /><br/>')
        //   $break.prependTo($newTweets) 
        // var clickHandler = function(){
        //   console.log(streams.users[tweet.user])
        // }

        //   $('div').on('click', clickHandler)


        })



      // console.log(getTime(streams.home[0].created_at))
      



      });

    </script>





  </body>





</html>
